<!DOCTYPE html>
<!-- Copyright 2017-2018 Vincent Jacques <vincent@vincent-jacques.net> -->
<html lang="en">
  <head>
    <title>Tests for JsOfOCairo</title>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <style type="text/css">
      canvas, img {
        border: 1px solid black;
        background-color: white;
      }
      #tests_in_browser li.success>p {
        background-color: #DFD;
      }
      #tests_in_browser li.failure>p {
        background-color: #F00;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <h1>Tests</h1>
      <p>These are the tests of the library.
      All tests before "Drawing tests on JsOfOCairo" should pass.
      The drawing tests compare an image generated by <em>Cairo</em> with a drawing made on an HTML5 canvas, <em>pixel-wise</em>.
      It's expected that some will fail with a few different pixels.
      It depends heavily on implementation details, for example the browser used to run the tests, and the version of <em>Cairo</em> used to generate the reference images.
      </p>
      <div id="tests_in_browser"></div>

      <h1>Limitations</h1>
      <p>This is a demonstration of things that behave differently in <em>JsOfOCairo</em> and <em>Cairo</em>.
      They are due to different behavior of the underlying <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D"><em>CanvasRenderingContext2D</em> API</a>.
      If you have concrete ideas on how to improve that, please <a href="https://github.com/jacquev6/JsOfOCairo/issues">open an issue</a>.</p>
      <p>Please see <a href="https://github.com/jacquev6/JsOfOCairo">the ReadMe</a> for rules to follow to avoid them.</p>
      <h2>Arcs on more than a full turn</h2>
      <p>If an arc spans more than a full turn, HTML5 reduces it to exactly one turn.
      The current point exposed through <tt>Path.get_current_point</tt> is inconsistent with the internal state of the canvas.
      The HTML5 and <em>Cairo</em> behaviors are different, and the HTML5 canvas interface doesn't expose the current point.
      This inconsistency is exposed if you use a function like <tt>line_to</tt> after an <tt>arc</tt> of more than one full turn.</p>
      <div class="row" id="limitations_arc_more_than_2pi"></div>
      <h2>Text and font extents</h2>
      <p>The HTML5 canvas interface doesn't expose functions to measure text and fonts, so this library contains <em>approximations</em> of <tt>get_text_extents</tt> and <tt>get_font_extents</tt>.</p>
      <div class="row" id="limitations_font_extents"></div>
      <div class="row" id="limitations_text_extents"></div>
      <h2>Text</h2>
      <p>Text is displayed differently according to available fonts.</p>
      <div class="row" id="limitations_show_text"></div>
      <h2>Use two contexts targeting a single canvas</h2>
      <p>There is only one context associated with an HTML5 canvas.
      <a><tt>getContext</tt></a> always returns the same object.
      Thus, if you create two <tt>JsOfOCairo.context</tt>s on the same canvas, changes made on one are replicated on the other.
      And because <em>JsOfOCairo</em> keeps some state to mirror the internal state of the HTML5 canvas, this leads to inconsistencies.</p>
      <p>The transformation made on the first HTML5 context impacts the second:</p>
      <div class="row" id="limitations_reuse_canvas_transformation"></div>
      <p>The line cap set on the first HTML5 context impacts the second. Same goes for other settings:</p>
      <div class="row" id="limitations_reuse_canvas_line_cap"></div>
    </div>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="pixelmatch.js"></script>
    <script src="tests_in_browser.bc.js"></script>
  </body>
</html>
