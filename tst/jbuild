(jbuild_version 1)


(executable (
  (name tests_in_native)
  (modules (tests_in_native))
  (libraries (Tests cairo2))
;  (preprocess (pps (bisect_ppx)))
))

(rule (
  (targets (tests_in_native.sentinel))
  (deps (tests_in_native.exe))
  (action (progn
    (run ${bin:rm} -f bisect0001.out bisect0002.out)
    (run ${bin:mkdir} -p Tests/Drawing/Cairo)
    (run ${exe:tests_in_native.exe})
    ;(run ${bin:bisect-summary} bisect0001.out)
    (run ${bin:bisect-ppx-report} -I .. -html ../bisect bisect0001.out)
    (write-file tests_in_native.sentinel sentinel)
  ))
))

(alias (
  (name runtest)
  (deps (tests_in_native.sentinel))
))


(executable (
  (name tests_in_node)
  (modules (tests_in_node))
  (libraries (Tests JsOfOCairo))
  (preprocess (pps (js_of_ocaml-ppx)))
  (js_of_ocaml ((flags (+nat.js))))
))

(rule (
  (targets (tests_in_node.sentinel))
  (deps (tests_in_node.js tests_in_node.bc.js tests_in_native.sentinel))
  (action (progn
    (run ${bin:mkdir} -p Tests/Drawing/JsOfOCairo)
    (run ${bin:node} tests_in_node.js)
    (write-file tests_in_node.sentinel sentinel)
  ))
))

(alias (
  (name runtest)
  (deps (tests_in_node.sentinel))
))


(executable (
  (name tests_in_browser)
  (modules (tests_in_browser))
  (libraries (Tests))
  (preprocess (pps (js_of_ocaml-ppx)))
  (js_of_ocaml ((flags (+nat.js))))
))

(alias (
  (name runtest)
  (deps (tests_in_browser.bc.js))
  (action (progn
    (echo "Have a look at drawing_tests_in_browser.html\n")
  ))
))





(executable (
  (name drawing_tests_in_javascript)
  (modules (drawing_tests_in_javascript))
  (preprocess (pps (js_of_ocaml-ppx)))
  (libraries (Tests JsOfOCairo))
  (js_of_ocaml ((flags (+nat.js))))
))

(alias (
  (name runtest)
  (deps (drawing_tests_in_javascript.bc.js))
  (action (progn
    (echo "Have a look at drawing_tests_in_browser.html\n")
  ))
))
