(jbuild_version 1)


(executable (
  (name tests_in_native)
  (modules (tests_in_native))
  (libraries (Tests cairo2))
;  (preprocess (pps (bisect_ppx)))
))

(alias (
  (name runtest)
  (deps (tests_in_native.bc tests_in_native.exe))
  (action (progn
    (run ${bin:rm} -f bisect0001.out bisect0002.out bisect0003.out)
    (run ${exe:tests_in_native.bc})
    (run ${exe:tests_in_native.exe})
    (run ${bin:bisect-summary} bisect0001.out bisect0002.out)
    (run ${bin:bisect-ppx-report} -I .. -html ../bisect bisect0001.out bisect0002.out)
  ))
))


(executable (
  (name tests_in_node)
  (modules (tests_in_node))
  (libraries (Tests JsOfOCairo))
  (preprocess (pps (js_of_ocaml-ppx)))
  (js_of_ocaml ((flags (+nat.js))))
))

(alias (
  (name runtest)
  (deps (tests_in_node.js tests_in_node.bc.js))
  (action (progn
    (run ${bin:node} tests_in_node.js)
  ))
))


(executable (
  (name tests_in_browser)
  (modules (tests_in_browser))
  (libraries (Tests))
  (preprocess (pps (js_of_ocaml-ppx)))
  (js_of_ocaml ((flags (+nat.js))))
))

(alias (
  (name runtest)
  (deps (tests_in_browser.bc.js))
  (action (progn
    (echo "Have a look at drawing_tests_in_browser.html\n")
  ))
))





(executable (
  (name drawing_tests_in_command_line)
  (modules (drawing_tests_in_command_line))
  (libraries (Tests cairo2))
;  (preprocess (pps (bisect_ppx)))
))

(executable (
  (name drawing_tests_in_javascript)
  (modules (drawing_tests_in_javascript))
  (preprocess (pps (js_of_ocaml-ppx)))
  (libraries (Tests JsOfOCairo))
  (js_of_ocaml ((flags (+nat.js))))
))

(alias (
  (name runtest)
  (deps (drawing_tests_in_command_line.bc drawing_tests_in_javascript.bc.js drawing_tests_in_node.js))
  (action (progn
    (run mkdir drawing_tests)
    (run mkdir drawing_tests/in_command_line)
    (run mkdir drawing_tests/in_node)
    (run ${exe:drawing_tests_in_command_line.bc})
    (run ${bin:node} drawing_tests_in_node.js)
  ))
))
