(jbuild_version 1)

(rule (
  (targets (JsOfOCairo.mli))
  (deps (JsOfOCairo.cppo.mli JsOfOCairo.signatures.ml))
  (action (run ${bin:cppo} -V OCAML:${ocaml_version} ${<} -o ${@}))
))

(rule (
  (targets (JsOfOCairo.ml))
  (deps (JsOfOCairo.cppo.ml JsOfOCairo.signatures.ml))
  (action (run ${bin:cppo} -V OCAML:${ocaml_version} ${<} -o ${@}))
))

(library (
  (name JsOfOCairo)
  (public_name JsOfOCairo)
  (modules (JsOfOCairo))
  (preprocess (pps (js_of_ocaml-ppx)))
  (libraries (js_of_ocaml))
))

(library (
  (name DrawingTests)
  (modules (DrawingTests))
  (libraries (JsOfOCairo))
))

(executable (
  (name drawing_tests_in_command_line)
  (modules (drawing_tests_in_command_line))
  (libraries (DrawingTests cairo2))
))

(executable (
  (name drawing_tests_in_javascript)
  (modules (drawing_tests_in_javascript))
  (preprocess (pps (js_of_ocaml-ppx)))
  (libraries (DrawingTests js_of_ocaml))
))

(alias (
  (name runtest)
  (deps (drawing_tests_in_command_line.bc drawing_tests_in_javascript.bc.js drawing_tests_in_node.js))
  (action (progn
    (run mkdir drawing_tests)
    (run mkdir drawing_tests/in_command_line)
    (run mkdir drawing_tests/in_node)
    (run ${exe:drawing_tests_in_command_line.bc})
    (run ${bin:node} drawing_tests_in_node.js)
  ))
))
